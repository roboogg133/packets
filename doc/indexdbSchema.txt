CREATE TABLE packages (
    id              TEXT NOT NULL UNIQUE PRIMARY KEY,
    query_name      TEXT NOT NULL,
    version         TEXT NOT NULL,
    serial          INTEGER NOT NULL,
    name            TEXT NOT NULL,
    description     TEXT NOT NULL,
    image_url       TEXT NOT NULL,
    package_url     TEXT NOT NULL,
    public_key      BLOB NOT NULL,
    signature       BLOB NOT NULL,
    author          TEXT NOT NULL,
    author_verified INTEGER NOT NULL DEFAULT 0,
    arch            TEXT NOT NULL,
    os              TEXT NOT NULL,
    size            INTEGER NOT NULL DEFAULT 0,

    UNIQUE(query_name, version),
    UNIQUE(query_name, serial)
);

CREATE TABLE package_dependencies(
    package_id TEXT NOT NULL,
    dependency_name TEXT NOT NULL,
    version_constraint TEXT NOT NULL,

    PRIMARY KEY (package_id, dependency_name)
);

CREATE INDEX index_dependency_name ON package_dependencies(dependency_name);


CREATE TABLE IF NOT EXISTS packages (
    query_name      TEXT NOT NULL UNIQUE PRIMARY KEY,
    id              TEXT NOT NULL UNIQUE, 
    version         TEXT NOT NULL, 
    dependencies    TEXT NOT NULL DEFAULT '', 
    description     TEXT NOT NULL,
    family          TEXT NOT NULL,
    serial          INTEGER NOT NULL UNIQUE, 
    package_d       TEXT NOT NULL,
    filename        TEXT NOT NULL,
    os              TEXT NOT NULL,
    arch            TEXT NOT NULL,
    in_cache        INTEGER NOT NULL DEFAULT 1,
    serial          INTEGER NOT NULL
);